name: Quick Tests

on:
  push:
    branches-ignore: [main, develop]
    paths:
      - "api/**"
  workflow_dispatch:

defaults:
  run:
    working-directory: ./api

jobs:
  quick-tests:
    name: Quick Unit Tests
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: "20.x"
          cache: "npm"
          cache-dependency-path: ./api/package-lock.json

      - name: Install dependencies
        run: npm ci

      - name: Generate Prisma Client
        run: npx prisma generate

      - name: Run quick linting
        run: npm run lint -- --quiet

      - name: Run all unit tests
        run: npm test -- --watchAll=false --verbose=false --silent

      - name: Test specific services (fast mode)
        run: |
          npm test -- cake.service.spec.ts --watchAll=false --silent
          npm test -- customer.service.spec.ts --watchAll=false --silent
          npm test -- order.service.spec.ts --watchAll=false --silent
          npm test -- prisma.service.spec.ts --watchAll=false --silent
          npm test -- auth.guard.spec.ts --watchAll=false --silent

      - name: Display success message
        run: |
          echo "âœ… All unit tests passed successfully!"
          echo "ðŸ§ª Services tested:"
          echo "  - CakeService (20 tests)"
          echo "  - CustomerService (19 tests)"
          echo "  - OrderService (21 tests)"
          echo "  - PrismaService (26 tests)"
          echo "  - AuthGuard (26 tests)"
          echo "ðŸ“Š Total: ~112 unit tests executed"
